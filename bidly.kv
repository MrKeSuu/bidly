#:kivy 2.2.1
#:import ui app.ui

<Bidly>:
    orientation: 'vertical'
    padding: (0, 0, 0, 10)
    spacing: 5

    deal_box: deal_box
    interaction_box: interaction_box

    DealBox:
        id: deal_box

    InteractionBox:
        id: interaction_box

        camera_button: camera_button
        restart_button: restart_button

        Button:
            id: camera_button
            text: 'Detect & Solve'
            size_hint_y: None
            height: '48dp'
            on_release:
                deal_box.camera_square.camera.play = False; self.disabled = True; \
                root.detect_solve(); restart_button.disabled = False

        Button:
            id: restart_button
            text: 'Restart'
            size_hint_y: None
            height: '48dp'
            disabled: True
            on_release: root.restart()


<DealBox>:
    size_hint: 1, None
    size: self.width, self.width / 3 * 4
    anim_move_duration: 0.3

    camera_square: camera_square

    CameraSquare:
        id: camera_square

<InteractionBox>:
    orientation: 'vertical'
    spacing: 5


<CameraSquare@FloatLayout>:
    camera: camera

    C4KCameraView:
        id: camera
        pos: root.pos

    BoxLayout:
        orientation: 'vertical'

        BgcolorLabel:
            size: (camera.width, camera.height / 8)  # ensure square frame
            background_color: 0, 0, 0, 0.5

        Label:
            pos: camera.pos
            size_hint_y: None
            height: camera.width

            text: 'N'
            color: 1, 1, 1, 0.5
            font_size: '50dp'
            text_size: self.size
            valign: 'top'
            halign: 'center'

            canvas:
                Color:
                    rgba: 1, 1, 1, 1
                Line:
                    points: 0, self.center_y + self.height/2, self.width, self.center_y - self.height/2
                    dash_length: 10
                    dash_offset: 10
                Line:
                    points: 0, self.center_y - self.height/2, self.width, self.center_y + self.height/2
                    dash_length: 10
                    dash_offset: 10

        BgcolorLabel:
            size: (camera.width, camera.height / 8)  # ensure square frame
            background_color: 0, 0, 0, 0.5

<CameraView>:
    resolution: (1600, 1200)  # one of the supported
    play: True
    fit_mode: 'cover'

    canvas.before:
        PushMatrix
        Rotate:
            angle: -90
            origin: self.center
    canvas.after:
        PopMatrix

<C4KCameraView>:
    aspect_ratio: '4:3'

<BgcolorLabel>:
    text: str(self.label_text)

    font_size: '18dp'
    font_name: 'app/fonts/FreeMono.ttf'
    color: 0.15, 0.15, 0.15, 1  # from medium.com

    text_size: self.size
    valign: 'center'
    halign: 'center'


<PopupLabel>:
    # https://stackoverflow.com/questions/66018633/is-there-a-way-to-adjust-the-size-of-content-in-a-kivy-popup
    text_size: self.size

# Define your background color Template
<BackgroundColor@Widget>
    background_color: 1, 1, 1, 1
    canvas.before:
        Color:
            rgba: root.background_color
        Rectangle:
            size: self.size
            pos: self.pos

# Now you can simply Mix the `BackgroundColor` class with almost
# any other widget... to give it a background.
<BgcolorLabel@Label+BackgroundColor>
    # Default the background color for this label
    # to r 0, g 0, b 0, a 0
    background_color: 1, 1, 1, 1
